var t={d:(e,i)=>{for(var a in i)t.o(i,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:i[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function i(t,e,i,a=!0){return t.filter((t=>a?t[e].includes(i):!t[e].includes(i)))}function a(t,e,i){return t.some((t=>t[e]===i))}t.d(e,{A:()=>r});class o{constructor(){this.data=null,this.previouslow=0,this.previoushigh=0,this.previouspoint="B",this.reqdnmove=0,this.requpmove=0,this.lasthighpoint={},this.lastlowpoint={},this.currentminind=0,this.currentmaxind=0,this.currentcdmin=0,this.currentcdmax=0,this.zigdata={gpoint:[]},this.upsidecount=1,this.downsidecount=1,this.permitmove=1e-4}static getInstance(){return o.instance||(o.instance=new o),o.instance}attachOHLCV(t){this.data=t}zdata(){let t=this.data;const e=[];if(t&&0===t.length)return e;var i=JSON.parse(JSON.stringify(t));const a=[];for(let t=0;t<i.length;t++){var o=0+t;i[t].orgindex=o,a.push(i[t])}for(let t=0;t<a.length;t++){var r=a[t];0==t&&(this.zigdata.gpoint=[{index:t,ind:"B"}],this.previouslow=r.low,this.previoushigh=r.high,this.previouspoint="B",this.reqdnmove=a[0].low-(a[0].high-a[0].low),this.requpmove=a[0].high+(a[0].high-a[0].low),this.lasthighpoint=a[0],this.lastlowpoint=a[0],this.currentminind=a[0].low,this.currentmaxind=a[0].high,this.currentcdmin=a[0].low,this.currentcdmax=a[0].high),0!==t&&(r.high>this.currentcdmax&&r.low>this.currentcdmin?(this.currentcdmin=r.low,this.currentcdmax=r.high,this.up_move(t,r,this.zigdata,a,this.requpmove,this.lastlowpoint)):r.high<this.currentcdmax&&r.low<this.currentcdmin?(this.currentcdmin=r.low,this.currentcdmax=r.high,this.down_move(t,r,this.zigdata,a,this.reqdnmove,this.lasthighpoint)):r.high>this.currentcdmax&&r.low<this.currentcdmin&&("HS"==this.previouspoint&&(this.currentcdmin=r.low,this.currentcdmax=r.high,this.up_move(t,r,this.zigdata,a,this.requpmove,this.lastlowpoint)),"LS"==this.previouspoint&&(this.currentcdmin=r.low,this.currentcdmax=r.high,this.down_move(t,r,this.zigdata,a,this.reqdnmove,this.lasthighpoint))))}if(this.zigdata.gpoint.map(((t,i)=>{var o=a[t.index];o.zigind=t.ind,o.orgindex=t.index,e.push(o)})),i.slice(-1)[0].timestamp>e.slice(-1)[0].timestamp){var n={timestamp:i.slice(-1)[0].timestamp,time:i.slice(-1)[0].time,zigind:"E",orgindex:i.length,high:"LS"==e.slice(-1)[0].zigind?e.slice(-1)[0].low:e.slice(-1)[0].high,low:e.slice(-1)[0].low,open:e.slice(-1)[0].open,close:e.slice(-1)[0].close,volume:e.slice(-1)[0].volume};e.push(n)}return e}up_move(t,e,i,a,o,r){var n,s;if(i.gpoint.length>1)var h=(null===(n=i.gpoint[i.gpoint.length-1])||void 0===n?void 0:n.index)||0;else h=0;var l=a.slice(h,t+1);let c=Math.max(...l.map((t=>t.high)));this.upsidecount>=2||"HS"==this.previouspoint?e.high>o&&e.high>=c&&("HS"==(null===(s=i.gpoint.at(-1))||void 0===s?void 0:s.ind)&&i.gpoint.pop(),"HS"==this.previouspoint&&(this.downsidecount=1),this.upsidecount=1,this.previouspoint="HS",i.gpoint=[...i.gpoint,{index:t,ind:"HS"}],this.get_newmove(r,t,a,1),this.lasthighpoint=a[t],this.currentmaxind=e.high):e.high>=c&&(this.upsidecount=this.upsidecount+1,this.currentmaxind=e.high)}down_move(t,e,i,a,o,r){var n,s;if(i.gpoint.length>1)var h=(null===(n=i.gpoint[i.gpoint.length-1])||void 0===n?void 0:n.index)||0;else h=0;var l=a.slice(h,t+1);let c=Math.min(...l.map((t=>t.low)));this.downsidecount>=2||"LS"==this.previouspoint?e.low<o&&e.low<a[h].low&&("LS"==(null===(s=i.gpoint[i.gpoint.length-1])||void 0===s?void 0:s.ind)&&i.gpoint.pop(),"LS"==this.previouspoint&&(this.upsidecount=1),this.downsidecount=1,this.previouspoint="LS",i.gpoint=[...i.gpoint,{index:t,ind:"LS"}],this.get_newmove(r,t,a,-1),this.lastlowpoint=a[t],this.currentminind=e.low):e.low<=c&&(this.downsidecount=this.downsidecount+1,this.currentminind=e.low)}get_newmove(t,e,i,a){var o=-1==a?t.high:t.low,r=-1==a?i[e].low:i[e].high,n=Math.abs(o-r);-1==a&&(this.requpmove=r+n*this.permitmove),1==a&&(this.reqdnmove=r-n*this.permitmove)}calculateEffortMetric(t,e,i,a,o){let r=0,n=0;const s=e+i/100*e,h=e-i/100*e;for(const i of t){const t=i.timestamp;if(i.high<=s&&i.high>=h)r++,n+=(i.high>=e&&i.close>e||i.high>=e&&i.close<=e?1:(i.high-h)/(e-h))*(1-(o-t)/(o-a));else if(i.high>s){n=0;break}}return{totalWeight:n,numAttempts:r}}getbreakouttrength({breakoutdetails:t,stockdata:e}){const i=t.latestbreakobj.broutfor,a=t.latestbreakobj.broutat,o=t.latestbreakobj.highatref,r={},n=e.filter((t=>{const e=t.timestamp;return e>i&&e<a}));return[.2,.5,1,3,5,8,10].forEach((t=>{const e=this.calculateEffortMetric(n,o,t,i,a);r[t]=e})),r}getbreakout({stockdata:t,zigdata:e,refpoint:i,lowpointfilter:a,getlatestbreakout:o}){var r=a.find((t=>t>i)),n=t[i].high;let s=NaN;var h={broutfor:NaN,broutat:NaN,rejectat:NaN,brekoutcandleago:NaN,breakoutperiod:NaN,breakoutpercentage:NaN,highatref:NaN,highatrejec:NaN,highatbr:NaN,closeatbr:NaN};for(let e=r;e<t.length;e++){const a=t[e].high,r=t[e].close;if(a>n&&r<n&&(n=a,s=e),r>n){let n=isNaN(s)?t[i].high:t[s].high;return h={broutfor:i,broutat:e,rejectat:isNaN(s)?i:s,brekoutcandleago:o.laststockindex+1-e,highatref:t[i].high,highatrejec:n,highatbr:a,closeatbr:r,breakoutperiod:e-i,breakoutpercentage:(r-n)/n*100},e>o.latestbrindex?(o.latestbrindex=e,o.breakoutperiod=e-i,o.latestbreakobj={broutfor:t[i].timestamp,broutat:t[e].timestamp,rejectat:isNaN(s)?t[i].timestamp:t[s].timestamp,brekoutcandleago:o.laststockindex+1-e,highatref:t[i].high,highatrejec:n,highatbr:a,closeatbr:r,breakoutperiod:e-i,breakoutpercentage:(r-n)/n*100}):e===o.latestbrindex&&e-i>o.breakoutperiod&&(o.breakoutperiod=e-i,o.latestbreakobj={broutfor:t[i].timestamp,broutat:t[e].timestamp,rejectat:isNaN(s)?t[i].timestamp:t[s].timestamp,brekoutcandleago:o.laststockindex+1-e,highatref:t[i].high,highatrejec:n,highatbr:a,closeatbr:r,breakoutperiod:e-i,breakoutpercentage:(r-n)/n*100}),h}}return h}fullbrtable({stockdata:t,zigdata:e}){const o=i(e,"zigind","HS",!0).map((t=>t.orgindex)),r=i(e,"zigind","LS",!0).map((t=>t.orgindex)),n=[],s={latestbrindex:-1,breakoutperiod:0,latestbreakobj:{broutfor:NaN,broutat:NaN,rejectat:NaN,brekoutcandleago:NaN,highatref:NaN,highatrejec:NaN,highatbr:NaN,closeatbr:NaN,breakoutperiod:NaN,breakoutpercentage:NaN},laststockindex:t.length-1};for(let i=0;i<o.length;i++){const h=o[i];if(!a(n,"rejectat",h)){const i=this.getbreakout({stockdata:t,zigdata:e,refpoint:h,lowpointfilter:r,getlatestbreakout:s});i&&n.push(i)}}return{FullBRDATA:n,latestbreakout:s,breakStrength:{}}}nearbrtable({stockdata:t,zigdata:e}){let a;"HS"==e[e.length-1].zigind&&e.splice(-1);var o=t.slice(-1),r=i(e,"zigind","HS",!0).map((t=>t.orgindex)),n=o[0].close,s=o[0].timestamp,h=r.filter((e=>t[e].high>n)).slice(-1);if(h.length>0){var l=h[0],c=t[l].high,d=(c-n)/c*100,g=Math.round(1e3*d)/1e3,u=t.length-1-l;a={pricetobebreak:c,lastclose:n,laginprct:g,candeldistance:u,tobebreakcandelid:l,timestamp:s}}else a={pricetobebreak:-1,lastclose:-1,laginprct:-1,candeldistance:-1,tobebreakcandelid:-1,timestamp:s};return a}nearbreakdown({stockdata:t,zigdata:e}){var a=t.slice(-1),o=a[0].close,r=a[0].timestamp;let n;"LS"==e[e.length-1].zigind&&e.splice(-1);var s=i(e,"zigind","LS",!0).map((t=>t.orgindex)).filter((e=>t[e].low<o)).slice(-1);if(s.length>0){var h=s[0],l=t[h].low,c=(o-l)/l*100,d=Math.round(1e3*c)/1e3,g=t.length-1-h;n={pricetobebreakdown:l,lastclose:o,laginprct:d,candeldistance:g,tobebreakcandelid:h,timestamp:r}}else n={pricetobebreakdown:-1,lastclose:-1,laginprct:-1,candeldistance:-1,tobebreakcandelid:-1,timestamp:r};return n}zseries(){let t=this.data,e=this.zdata().map((({time:t,zigind:e,low:i,high:a,orgindex:o})=>({time:t,orgindex:o,value:"LS"==e?i:a,zigind:e,zigType:""})));for(let t=2;t<e.length-1;t++){const i=e[t].value,a=Math.max(e[t-1].value,e[t-2].value),o=Math.min(e[t-1].value,e[t-2].value);i>a?e[t].zigType="HH":i<o?e[t].zigType="LL":i>e[t-1].value?e[t].zigType="LH":e[t].zigType="HL"}const i=e.length-1;var a=0;if(i>=6){const t=[e[i-5].zigType,e[i-4].zigType,e[i-3].zigType,e[i-2].zigType,e[i-1].zigType].join("-");if("HL-LH-HL-LH-HL"===t){const t=e[i-2].value,o=e[i-4].value;Math.abs(t-o)/t*100<1&&(a=1)}else if("HL-HH-HL-HH-HL"===t){const t=e[i-2].value,o=e[i-4].value;Math.abs(t-o)/t*100<1&&(a=1)}else if("LH-HL-HH-HL-HH"===t){const t=e[i-1].value,o=e[i-3].value;Math.abs(t-o)/t*100<1&&(a=1)}}const o=this.fullbrtable({stockdata:t,zigdata:[...e]}),r=this.nearbrtable({stockdata:t,zigdata:[...e]}),n=this.nearbreakdown({stockdata:t,zigdata:[...e]});return{sublist:e,brlist:o.FullBRDATA,lastbreakout:o.latestbreakout,tobebreakdata:r,tobebreakdowndata:n,breakStrenth:o.breakStrength,Tr_patternMark:a}}}o.instance=null;const r=o;var n=e.A;export{n as default};